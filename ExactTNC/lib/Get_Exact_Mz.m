function [Mz] = Get_Exact_Mz(A)
   
Ac = InitColTensor(A)

% MPO representation of total Sz
% {I, S0}*{I, S1;0, I}*{I, S2;0, I}...{I, Sn-1;0, I}*{Sn;I}
Id = eye(2);
S1 = [1.0, 0.0; 0.0, -1.0];
M0 = zeros([2,2,2,2]);        % M0(m,m',l,r)
M0(:,:,1,1) = Id;
M0(:,:,2,2) = Id;
M0(:,:,1,2) = S1;

S3 = reshape(ncon({M0(:,:,1,:), M0, M0(:,:,:,2)}, {[-1,-4,1], [-2,-5,1,2], [-3,-6,2]}, [2,1]),[2^3, 2^3]);
S5 = reshape(ncon({M0(:,:,1,:), M0, M0, M0, M0(:,:,:,2)}, {[-1,-6,1],[-2,-7,1,2],[-3,-8,2,3],[-4,-9,3,4],[-5,-10,4]},[1,2,4,3]),[2^5,2^5]);
S6 = reshape(ncon({M0(:,:,1,:), M0, M0, M0, M0, M0(:,:,:,2)}, {[-1,-7,1],[-2,-8,1,2],...
	 [-3,-9,2,3],[-4,-10,3,4],[-5,-11,4,5], [-6,-12,5]},[1,2,5,4,3]),[2^6,2^6]);
S7 = reshape(ncon({M0(:,:,1,:), M0, M0, M0, M0, M0, M0(:,:,:,2)}, {[-1,-8,1], [-2,-9,1,2],...
	 [-3,-10,2,3],[-4,-11,3,4],[-5,-12,4,5],[-6,-13,5,6],[-7,-14,6]},[1,2,3,6,5,4]),[2^7,2^7]);
SS = {S1, S3, S5, S6, S7};

CL, CM = LeftMove1st(SS, Ac)
CL, CM = LeftMoveOdd(CL, CM, SS, Ac)
CL, CM = LeftMoveEvn(CL, CM, SS, Ac)
CL, CM = LeftMoveOdd(CL, CM, SS, Ac)
CL, CM = LeftMoveEvn(CL, CM, SS, Ac)
CL, CM = LeftMoveOdd(CL, CM, SS, Ac)
NL, NM = LeftMoveLst(CL, CM, SS, Ac)

Mz = NM.real/NL.real

end

function [CL, CM] = LeftMove1st(SS, A)
%%  contract first column
%   A{0}{0} = A6                % A{0}{0}: 13-12-17-11-10-9
%   A{0}{1} = A3                % A{0}{1}: 8
%   A{0}{2} = A2                % A{0}{2}: 16
%   A{0}{3} = A2_3              % A{0}{3}: 7-6-5
%   A{0}{4} = A3                % A{0}{4}: 4
%   A{0}{5} = A2                % A{0}{5}: 15
%   A{0}{6} = A2_7              % A{0}{6}: 3-2-1-0-14-18-19
[S1, S3, S5, S6, S7] = deal( SS{1}, SS{2}, SS{3}, SS{4}, SS{5} );

D = size(A{1,3},2)
D2 = D*D;

C6 = reshape(ncon({conj(A{1,1}), A{1,1}}, {[1,-1,-3], [1,-2,-4]}, [1]),[D2,D2]);
T8 = reshape(ncon({conj(A{1,2}), A{1,2}}, {[1,-1,-3,-5], [1,-2,-4,-6]}, [1]),[D2,D2,D2]);   % T8(d,l,r)
T16 = reshape(ncon({conj(A{1,3}), A{1,3}}, {[1,-1,-3], [1,-2,-4]}, [1]),[D2,D2]);

Cu = reshape(ncon({C6, T8, T16}, {[1,-1], [-3,1,2], [2,-2]}, [1,2]),[D2*D2,D2]);

C3 = reshape(ncon({conj(A{1,4}), A{1,4}}, {[1,-1,-3], [1,-2,-4]}, [1]),[D2,D2]);
T4 = reshape(ncon({conj(A{1,5}), A{1,5}}, {[1,-1,-3,-5], [1,-2,-4,-6]}, [1]),[D2,D2,D2]);    % T4(d,l,r)
T15 = reshape(ncon({conj(A{1,6}), A{1,6}}, {[1,-1,-3], [1,-2,-4]}, [1]),[D2,D2]);
C7 = reshape(ncon({conj(A{1,7}), A{1,7}}, {[1,-1,-3], [1,-2,-4]}, [1]),[D2,D2]);

Cd = reshape(ncon({C3, T4, T15, C7}, {[-1,2], [1,2,3], [3,-2], [1,-3]}, [1,2,3]),[D2,D2*D2]);

CL = Cu * Cd;       % CL(1'1,2'2,3'3,4'4)

E6 = reshape(ncon({conj(A{1,1}), S6, A{1,1}}, {[1,-1,-3], [1,2], [2,-2,-4]}, [1,2]),[D2,D2]);
E8 = reshape(ncon({conj(A{1,2}), S1, A{1,2}}, {[1,-1,-3,-5], [1,2], [2,-2,-4,-6]}, [1,2]),[D2,D2,D2]);    % E8(d,l,r)
E16 = reshape(ncon({conj(A{1,3}), S1, A{1,3}}, {[1,-1,-3], [1,2], [2,-2,-4]}, [1,2]),[D2,D2]);

E3 = reshape(ncon({conj(A{1,4}), S3, A{1,4}}, {[1,-1,-3], [1,2], [2,-2,-4]}, [1,2]),[D2,D2]);
E4 = reshape(ncon({conj(A{1,5}), S1, A{1,5}}, {[1,-1,-3,-5], [1,2], [2,-2,-4,-6]}, [1,2]),[D2,D2,D2]);    % E8(d,l,r)
E15 = reshape(ncon({conj(A{1,6}), S1, A{1,6}}, {[1,-1,-3], [1,2], [2,-2,-4]}, [1,2]),[D2,D2]);
E7 = reshape(ncon({conj(A{1,7}), S7, A{1,7}}, {[1,-1,-3], [1,2], [2,-2,-4]}, [1,2]),[D2,D2]);

Mu = reshape(ncon({E6, T8, T16}, {[1,-1], [-3,1,2], [2,-2]}, [1,2]},[D2*D2,D2]);
Mu = Mu + reshape(ncon({C6, E8, T16}, ([1,-1], [-3,1,2], [2,-2]}, [1,2]),[D2*D2,D2]);
Mu = Mu + reshape(ncon({C6, T8, E16}, ([1,-1], [-3,1,2], [2,-2]}, [1,2]),[D2*D2,D2]);

Md = reshape(ncon({E3, T4, T15, C7}, {[-1,2], [1,2,3], [3,-2], [1,-3]}, [1,2,3]),[D2,D2*D2]);
Md = Md + reshape(ncon({C3, E4, T15, C7}, {[-1,2], [1,2,3], [3,-2], [1,-3]}, [1,2,3]),[D2,D2*D2]);
Md = Md + reshape(ncon({C3, T4, E15, C7}, {[-1,2], [1,2,3], [3,-2], [1,-3]}, [1,2,3]),[D2,D2*D2]);
Md = Md + reshape(ncon({C3, T4, T15, E7}, {[-1,2], [1,2,3], [3,-2], [1,-3]}, [1,2,3]),[D2,D2*D2]);

CM = Mu @ Cd + Cu @ Md

end

function [CL, CM] = LeftMoveOdd(ix, CL, CM, SS, A)
%%  contract even column: 1, 3, 5
%   A{1}{0} = A2_5              % A{1}{0}: 31-32-36-51-50
%   A{1}{1} = A4                % A{1}{1}: 30-29-28
%   A{1}{2} = A2                % A{1}{2}: 35
%   A{1}{3} = A2                % A{1}{3}: 27
%   A{1}{4} = A4                % A{1}{4}: 26-25-24
%   A{1}{5} = A2                % A{1}{5}: 34
%   A{1}{6} = A2                % A{1}{6}: 23
%   A{1}{7} = A4                % A{1}{7}: 22-21-20
%   A{1}{8} = A2                % A{1}{8}: 33
[S1, S3, S5, S6, S7] = deal( SS{1}, SS{2}, SS{3}, SS{4}, SS{5} );

Am = cell(1,9);
if( size(A{ix,1},1) == 2^5 )
    Am{1} = ncon({S5, A{ix,1}}, {[-1,1], [1,-2,-3]}, [1]);
elseif( size(A{ix,1},1) == 2^7 )
    Am{1} = ncon({S7, A{ix,1}}, {[-1,1], [1,-2,-3]}, [1]);
end

Am{2} = ncon({S3, A{1}}, {[-1,1], [1,-2,-3,-4,-5]}, ]1]);
Am{3} = ncon({S1, A{2}}, {[-1,1], [1,-2,-3]}, [1]);
Am{4} = ncon({S1, A{3}}, {[-1,1], [1,-2,-3]}, [1]);
Am{5} = ncon({S3, A{4}}, {[-1,1], [1,-2,-3,-4,-5]}, {1});
Am{6} = ncon({S1, A{5}}, {[-1,1], [1,-2,-3]}, [1]);
Am{7} = ncon({S1, A{6}}, {[-1,1], [1,-2,-3]}, [1]);
Am{8} = ncon({S3, A{7}}, {[-1,1], [1,-2,-3,-4,-5]}, [1]);
Am{9} = ncon({S1, A{8}}, {[-1,1], [1,-2,-3]}, [1]);

Da = A{2}.shape{1}
Db = A{2}.shape{1}
D2 = Da*Db
CL = reshape(CL, {D2, D2, Db, Da, Db, Da})
CM = reshape(CM, {D2, D2, Db, Da, Db, Da})
CM = ncon({CM, conj(A{7}), A{7}}, ({-1,-2,1,3,2,4}, {5,1,2,-3,-5}, {5,3,4,-4,-6}), {1,2,3,4,5})
CM = ncon({CM, conj(A{6}), A{6}, conj(A{8}), A{8}}, \
({-1,-2,1,2,4,5}, {3,1,-3}, {3,2,-4}, {6,4,-5}, {6,5,-6}), {1,2,3,4,5,6})

Mmp = ncon({CL, conj(A{7}), Am{7}}, ({-1,-2,1,3,2,4}, {5,1,2,-3,-5}, {5,3,4,-4,-6}), {1,2,3,4,5})
CM = CM + ncon({Mmp, conj(A{6}), A{6}, conj(A{8}), A{8}}, \
({-1,-2,1,2,4,5}, {3,1,-3}, {3,2,-4}, {6,4,-5}, {6,5,-6}), {1,2,3,4,5,6})

CL = ncon({CL, conj(A{7}), A{7}}, ({-1,-2,1,3,2,4}, {5,1,2,-3,-5}, {5,3,4,-4,-6}), {1,2,3,4,5})
CM = CM + ncon({CL, conj(A{6}), Am{6}, conj(A{8}), A{8}}, \
({-1,-2,1,2,4,5}, {3,1,-3}, {3,2,-4}, {6,4,-5}, {6,5,-6}), {1,2,3,4,5,6})
CM = CM + ncon({CL, conj(A{6}), A{6}, conj(A{8}), Am{8}}, \
({-1,-2,1,2,4,5}, {3,1,-3}, {3,2,-4}, {6,4,-5}, {6,5,-6}), {1,2,3,4,5,6})
CL = ncon({CL, conj(A{6}), A{6}, conj(A{8}), A{8}}, \
({-1,-2,1,2,4,5}, {3,1,-3}, {3,2,-4}, {6,4,-5}, {6,5,-6}), {1,2,3,4,5,6})

CL = reshape(CL, {D2, Db, Da, Db, Da, D2})
CM = reshape(CM, {D2, Db, Da, Db, Da, D2})
CM = ncon({CM, conj(A{4}), A{4}}, ({-1,1,3,2,4,-6}, {5,1,2,-2,-4}, {5,3,4,-3,-5}), {1,2,3,4,5})
CM = ncon({CM, conj(A{3}), A{3}, conj(A{5}), A{5}}, \
({-1,1,2,4,5,-6}, {3,1,-2}, {3,2,-3}, {6,4,-4}, {6,5,-5}), {1,2,3,4,5,6})

Mmp = ncon({CL, conj(A{4}), Am{4}}, ({-1,1,3,2,4,-6}, {5,1,2,-2,-4}, {5,3,4,-3,-5}), {1,2,3,4,5})
CM = CM + ncon({Mmp, conj(A{3}), A{3}, conj(A{5}), A{5}}, \
({-1,1,2,4,5,-6}, {3,1,-2}, {3,2,-3}, {6,4,-4}, {6,5,-5}), {1,2,3,4,5,6})

CL = ncon({CL, conj(A{4}), A{4}}, ({-1,1,3,2,4,-6}, {5,1,2,-2,-4}, {5,3,4,-3,-5}), {1,2,3,4,5})
CM = CM + ncon({CL, conj(A{3}), Am{3}, conj(A{5}), A{5}}, \
({-1,1,2,4,5,-6}, {3,1,-2}, {3,2,-3}, {6,4,-4}, {6,5,-5}), {1,2,3,4,5,6})
CM = CM + ncon({CL, conj(A{3}), A{3}, conj(A{5}), Am{5}}, \
({-1,1,2,4,5,-6}, {3,1,-2}, {3,2,-3}, {6,4,-4}, {6,5,-5}), {1,2,3,4,5,6})
CL = ncon({CL, conj(A{3}), A{3}, conj(A{5}), A{5}}, \
({-1,1,2,4,5,-6}, {3,1,-2}, {3,2,-3}, {6,4,-4}, {6,5,-5}), {1,2,3,4,5,6})

CL = reshape(CL, {Db, Da, Db, Da, D2, D2})
CM = reshape(CM, {Db, Da, Db, Da, D2, D2})
CM = ncon({CM, conj(A{1}), A{1}, conj(A{2}), A{2}}, \
({1,3,2,4,-5,-6}, {5,1,2,-1,6}, {5,3,4,-2,7}, {8,6,-3}, {8,7,-4}), {1,2,3,4,5,6,7,8}).reshape({D2,D2*D2*D2})
CM = CM + ncon({CL, conj(A{1}), Am{1}, conj(A{2}), A{2}}, \
({1,3,2,4,-5,-6}, {5,1,2,-1,6}, {5,3,4,-2,7}, {8,6,-3}, {8,7,-4}), {1,2,3,4,5,6,7,8}).reshape({D2,D2*D2*D2})
CM = CM + ncon({CL, conj(A{1}), A{1}, conj(A{2}), Am{2}}, \
({1,3,2,4,-5,-6}, {5,1,2,-1,6}, {5,3,4,-2,7}, {8,6,-3}, {8,7,-4}), {1,2,3,4,5,6,7,8}).reshape({D2,D2*D2*D2})
CL = ncon({CL, conj(A{1}), A{1}, conj(A{2}), A{2}}, \
({1,3,2,4,-5,-6}, {5,1,2,-1,6}, {5,3,4,-2,7}, {8,6,-3}, {8,7,-4}), {1,2,3,4,5,6,7,8}).reshape({D2,D2*D2*D2})

C5 = ncon({conj(A{0}), A{0}}, ({1,-3,-1}, {1,-4,-2}), {1}).reshape({D2,D2})
M5 = ncon({conj(A{0}), Am{0}}, ({1,-3,-1}, {1,-4,-2}), {1}).reshape({D2,D2})
CM = M5 @ CL + C5 @ CM
CL = C5 @ CL

end

function [CL, CM] = LeftMoveEvn(CL, CM, SS, A)
%%  contract odd column: 2, 4
%   A{2}{0} = A4                % A{2}{0}: 49-48-47
%   A{2}{1} = A2                % A{2}{1}: 55
%   A{2}{2} = A2                % A{2}{2}: 46
%   A{2}{3} = A4                % A{2}{3}: 45-44-43
%   A{2}{4} = A2                % A{2}{4}: 54
%   A{2}{5} = A2                % A{2}{5}: 42
%   A{2}{6} = A4                % A{2}{6}: 41-40-39
%   A{2}{7} = A2                % A{2}{7}: 53
%   A{2}{8} = A2_5              % A{2}{8}: 38-37-52-56-57

[S1, S3, S5, S6, S7] = deal( SS{1}, SS{2}, SS{3}, SS{4}, SS{5} );

Am = {}
Am = ncon({S3, A{0}}, ({-1,1}, {1,-2,-3,-4,-5}), {1}))
Am = ncon({S1, A{1}}, ({-1,1}, {1,-2,-3}), {1}))
Am = ncon({S1, A{2}}, ({-1,1}, {1,-2,-3}), {1}))
Am = ncon({S3, A{3}}, ({-1,1}, {1,-2,-3,-4,-5}), {1}))
Am = ncon({S1, A{4}}, ({-1,1}, {1,-2,-3}), {1}))
Am = ncon({S1, A{5}}, ({-1,1}, {1,-2,-3}), {1}))
Am = ncon({S3, A{6}}, ({-1,1}, {1,-2,-3,-4,-5}), {1}))
Am = ncon({S1, A{7}}, ({-1,1}, {1,-2,-3}), {1}))
Am = ncon({S5, A{8}}, ({-1,1}, {1,-2,-3}), {1}))

Da = A{2}.shape{1}
Db = A{2}.shape{1}
D2 = Da*Db
CL = reshape(CL, {Db, Da, Db, Da, D2, D2})
CM = reshape(CM, {Db, Da, Db, Da, D2, D2})
CM = ncon({CM, conj(A{0}), A{0}}, ({1,3,2,4,-5,-6}, {5,1,2,-1,-3}, {5,3,4,-2,-4}), {1,2,3,4,5})
CM = ncon({CM, conj(A{1}), A{1}, conj(A{2}), A{2}}, \
({1,2,4,5,-5,-6}, {3,1,-1}, {3,2,-2}, {6,4,-3}, {6,5,-4}), {1,2,3,4,5,6})

Mmp = ncon({CL, conj(A{0}), Am{0}}, ({1,3,2,4,-5,-6}, {5,1,2,-1,-3}, {5,3,4,-2,-4}), {1,2,3,4,5})
CM = CM + ncon({Mmp, conj(A{1}), A{1}, conj(A{2}), A{2}}, \
({1,2,4,5,-5,-6}, {3,1,-1}, {3,2,-2}, {6,4,-3}, {6,5,-4}), {1,2,3,4,5,6})

CL = ncon({CL, conj(A{0}), A{0}}, ({1,3,2,4,-5,-6}, {5,1,2,-1,-3}, {5,3,4,-2,-4}), {1,2,3,4,5})
CM = CM + ncon({CL, conj(A{1}), Am{1}, conj(A{2}), A{2}}, \
({1,2,4,5,-5,-6}, {3,1,-1}, {3,2,-2}, {6,4,-3}, {6,5,-4}), {1,2,3,4,5,6})
CM = CM + ncon({CL, conj(A{1}), A{1}, conj(A{2}), Am{2}}, \
({1,2,4,5,-5,-6}, {3,1,-1}, {3,2,-2}, {6,4,-3}, {6,5,-4}), {1,2,3,4,5,6})
CL = ncon({CL, conj(A{1}), A{1}, conj(A{2}), A{2}}, \
({1,2,4,5,-5,-6}, {3,1,-1}, {3,2,-2}, {6,4,-3}, {6,5,-4}), {1,2,3,4,5,6})

CL = reshape(CL, {D2, Db, Da, Db, Da, D2})
CM = reshape(CM, {D2, Db, Da, Db, Da, D2})
CM = ncon({CM, conj(A{3}), A{3}}, ({-1,1,3,2,4,-6}, {5,1,2,-2,-4}, {5,3,4,-3,-5}), {1,2,3,4,5})
CM = ncon({CM, conj(A{4}), A{4}, conj(A{5}), A{5}}, \
({-1,1,2,4,5,-6}, {3,1,-2}, {3,2,-3}, {6,4,-4}, {6,5,-5}), {4,5,6,1,2,3})

Mmp = ncon({CL, conj(A{3}), Am{3}}, ({-1,1,3,2,4,-6}, {5,1,2,-2,-4}, {5,3,4,-3,-5}), {1,2,3,4,5})
CM = CM + ncon({Mmp, conj(A{4}), A{4}, conj(A{5}), A{5}}, \
({-1,1,2,4,5,-6}, {3,1,-2}, {3,2,-3}, {6,4,-4}, {6,5,-5}), {4,5,6,1,2,3})

CL = ncon({CL, conj(A{3}), A{3}}, ({-1,1,3,2,4,-6}, {5,1,2,-2,-4}, {5,3,4,-3,-5}), {1,2,3,4,5})
CM = CM + ncon({CL, conj(A{4}), Am{4}, conj(A{5}), A{5}}, \
({-1,1,2,4,5,-6}, {3,1,-2}, {3,2,-3}, {6,4,-4}, {6,5,-5}), {4,5,6,1,2,3})
CM = CM + ncon({CL, conj(A{4}), A{4}, conj(A{5}), Am{5}}, \
({-1,1,2,4,5,-6}, {3,1,-2}, {3,2,-3}, {6,4,-4}, {6,5,-5}), {4,5,6,1,2,3})
CL = ncon({CL, conj(A{4}), A{4}, conj(A{5}), A{5}}, \
({-1,1,2,4,5,-6}, {3,1,-2}, {3,2,-3}, {6,4,-4}, {6,5,-5}), {4,5,6,1,2,3})

CL = reshape(CL, {D2, D2, Db, Da, Db, Da})
CM = reshape(CM, {D2, D2, Db, Da, Db, Da})
CM = ncon({CM, conj(A{6}), A{6}, conj(A{7}), A{7}}, \
({-1,-2,1,3,2,4}, {5,1,2,6,-5}, {5,3,4,7,-6}, {8,6,-3}, {8,7,-4}), {1,2,3,4,5,6,7,8})
CM = CM + ncon({CL, conj(A{6}), Am{6}, conj(A{7}), A{7}}, \
({-1,-2,1,3,2,4}, {5,1,2,6,-5}, {5,3,4,7,-6}, {8,6,-3}, {8,7,-4}), {1,2,3,4,5,6,7,8})
CM = CM + ncon({CL, conj(A{6}), A{6}, conj(A{7}), Am{7}}, \
({-1,-2,1,3,2,4}, {5,1,2,6,-5}, {5,3,4,7,-6}, {8,6,-3}, {8,7,-4}), {1,2,3,4,5,6,7,8})
CL = ncon({CL, conj(A{6}), A{6}, conj(A{7}), A{7}}, \
({-1,-2,1,3,2,4}, {5,1,2,6,-5}, {5,3,4,7,-6}, {8,6,-3}, {8,7,-4}), {1,2,3,4,5,6,7,8})

CL = reshape(CL, {D2*D2*D2,D2})
CM = reshape(CM, {D2*D2*D2,D2})
C5 = ncon({conj(A{8}), A{8}}, ({1,-1,-3}, {1,-2,-4}), {1}).reshape({D2,D2})
M5 = ncon({conj(A{8}), Am{8}}, ({1,-1,-3}, {1,-2,-4}), {1}).reshape({D2,D2})
CM = CL @ M5 + CM @ C5
CL = CL @ C5

end

function [NormC, NormM] = LeftMoveLst(CL, CM, SS, A)
%%  contract last column: 6
%   A{6}{0} = A3                % A{6}{0}: 122                       % A{122}(m,u,l,r)
%   A{6}{1} = A2_3              % A{6}{1}: 121-120-119
%   A{6}{2} = A3                % A{6}{2}: 118                       % A{118}(m,u,l,r)
%   A{6}{3} = A2_5              % A{6}{3}: 117-116-115-114-113

[S1, S3, S5, S6, S7] = deal( SS{1}, SS{2}, SS{3}, SS{4}, SS{5} );

Am = {}
Am = ncon({S1, A{0}}, ({-1,1}, {1,-2,-3,-4}), {1}))
Am = ncon({S3, A{1}}, ({-1,1}, {1,-2,-3}), {1}))
Am = ncon({S1, A{2}}, ({-1,1}, {1,-2,-3,-4}), {1}))
Am = ncon({S5, A{3}}, ({-1,1}, {1,-2,-3}), {1}))

Da = A{0}.shape{1}
Db = A{0}.shape{1}
D2 = Da*Db
CL = reshape(CL, {Db, Da, Db, Da, D2, D2})
CM = reshape(CM, {Db, Da, Db, Da, D2, D2})
CM = ncon({CM, conj(A{0}), A{0}}, ({1,3,2,4,-3,-4}, {5,1,2,-1}, {5,3,4,-2}), {1,2,3,4,5}).reshape({D2,D2,D2})
CM = CM + ncon({CL, conj(A{0}), Am{0}}, ({1,3,2,4,-3,-4}, {5,1,2,-1}, {5,3,4,-2}), {1,2,3,4,5}).reshape({D2,D2,D2})

CL = ncon({CL, conj(A{0}), A{0}}, ({1,3,2,4,-3,-4}, {5,1,2,-1}, {5,3,4,-2}), {1,2,3,4,5}).reshape({D2,D2,D2})

C3 = ncon({conj(A{1}), A{1}}, ({1,-1,-3}, {1,-2,-4}), {1}).reshape({D2,D2})
C5 = ncon({conj(A{3}), A{3}}, ({1,-1,-3}, {1,-2,-4}), {1}).reshape({D2,D2})
T118 = ncon({conj(A{2}), A{2}}, ({1,-1,-3,-5}, {1,-2,-4,-6}), {1}).reshape({D2,D2,D2})    % T3(u,l,r)

E3 = ncon({conj(A{1}), Am{1}}, ({1,-1,-3}, {1,-2,-4}), {1}).reshape({D2,D2})
E5 = ncon({conj(A{3}), Am{3}}, ({1,-1,-3}, {1,-2,-4}), {1}).reshape({D2,D2})
E118 = ncon({conj(A{2}), Am{2}}, ({1,-1,-3,-5}, {1,-2,-4,-6}), {1}).reshape({D2,D2,D2})    % T3(u,l,r)

NormC = ncon({CL, T118, C3, C5}, ({1,2,3}, {4,2,5}, {1,4}, {5,3}), {1,3,2,4,5})

NormM = ncon({CM, T118, C3, C5}, ({1,2,3}, {4,2,5}, {1,4}, {5,3}), {1,3,2,4,5})
NormM = NormM + ncon({CL, E118, C3, C5}, ({1,2,3}, {4,2,5}, {1,4}, {5,3}), {1,3,2,4,5})
NormM = NormM + ncon({CL, T118, E3, C5}, ({1,2,3}, {4,2,5}, {1,4}, {5,3}), {1,3,2,4,5})
NormM = NormM + ncon({CL, T118, C3, E5}, ({1,2,3}, {4,2,5}, {1,4}, {5,3}), {1,3,2,4,5})

end



